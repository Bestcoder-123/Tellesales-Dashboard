<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Pharma_Dashboard_Flip</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100vh;
      overflow: hidden;
      background: black;
      font-family: Arial, sans-serif;
      perspective: 1200px;
    }

    .screen {
      position: absolute;
      width: 100%;
      height: 100%;
      top: 0;
      left: 0;
      opacity: 0;
      transform: rotateY(180deg);
      transform-origin: center;
      transition: opacity 1.5s ease-in-out, transform 4s ease-in-out;
      background: black;
      backface-visibility: hidden;
      display: none; /* ðŸ‘ˆ hidden until password success */
    }

    .active {
      opacity: 1;
      transform: rotateY(0deg);
      z-index: 2;
      display: block;
    }

    iframe {
      width: 100%;
      height: 100%;
      border: none;
      background: black;
    }

    header {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      background: linear-gradient(90deg, #001f1f, #004d4d);
      padding: 6px 0;
      text-align: center;
      font-size: 1em;
      font-weight: bold;
      color: #00ffcc;
      text-shadow: 1px 1px 4px black;
      border-bottom: 2px solid #00ffcc;
      z-index: 3;
    }

    /* ===== Password Modal Styles ===== */
    .pw-modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.9);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 9999;
    }

    .pw-modal {
      background: linear-gradient(180deg, #041616 0%, #003735 100%);
      padding: 24px;
      border-radius: 12px;
      width: 380px;
      max-width: calc(100% - 32px);
      box-shadow: 0 8px 40px rgba(0, 0, 0, 0.8);
      color: #00ffd1;
      text-align: center;
      border: 2px solid rgba(0, 255, 204, 0.08);
      font-family: Arial, sans-serif;
    }

    .pw-modal h2 {
      margin: 0 0 12px 0;
      font-size: 1.1rem;
      letter-spacing: 0.6px;
    }

    .pw-modal p {
      margin: 0 0 16px 0;
      font-size: 0.9rem;
      opacity: 0.85;
    }

    .pw-input {
      width: 100%;
      box-sizing: border-box;
      padding: 10px 12px;
      font-size: 1rem;
      border-radius: 6px;
      border: 1px solid rgba(0, 255, 204, 0.12);
      background: rgba(255, 255, 255, 0.02);
      color: #e6fff9;
      outline: none;
      margin-bottom: 12px;
    }

    .pw-actions {
      display: flex;
      gap: 8px;
      justify-content: center;
    }

    .pw-btn {
      padding: 8px 14px;
      border-radius: 8px;
      border: none;
      cursor: pointer;
      font-weight: 600;
      font-size: 0.95rem;
      background: rgba(0, 255, 204, 0.08);
      color: #00ffd1;
      transition: transform 0.08s ease;
    }

    .pw-btn:active { transform: translateY(1px); }
    .pw-btn.cancel { background: rgba(255, 80, 80, 0.08); color: #ff8a8a; }

    .pw-error {
      color: #ff8080;
      font-size: 0.9rem;
      height: 1.1rem;
      margin-top: 8px;
      opacity: 0.95;
    }
  </style>

  <!-- ðŸ”’ Password Protection -->
  <script>
    const correctPassword = "Pharma@2025";
    const storageKey = "auth_pharma";

    function createPasswordModal(onSuccess, onCancel) {
      const overlay = document.createElement("div");
      overlay.className = "pw-modal-overlay";
      overlay.innerHTML = `
        <div class="pw-modal">
          <h2>Enter password to access Pharma Dashboard</h2>
          <p>Your input is hidden for privacy.</p>
          <input id="pwInput" class="pw-input" type="password" placeholder="Password" />
          <div class="pw-actions">
            <button id="pwSubmit" class="pw-btn">Enter</button>
            <button id="pwCancel" class="pw-btn cancel">Cancel</button>
          </div>
          <div id="pwError" class="pw-error"></div>
        </div>
      `;
      document.body.appendChild(overlay);

      const input = overlay.querySelector("#pwInput");
      const submit = overlay.querySelector("#pwSubmit");
      const cancel = overlay.querySelector("#pwCancel");
      const error = overlay.querySelector("#pwError");

      input.focus();

      submit.onclick = () => {
        if (input.value === correctPassword) {
          sessionStorage.setItem(storageKey, "true");
          overlay.remove();
          onSuccess && onSuccess();
        } else {
          error.textContent = "Incorrect password. Try again.";
          input.value = "";
          input.focus();
        }
      };

      cancel.onclick = () => {
        overlay.remove();
        onCancel && onCancel();
      };

      input.addEventListener("keydown", (e) => {
        if (e.key === "Enter") submit.click();
        if (e.key === "Escape") cancel.click();
      });
    }

    async function authenticate() {
      const authenticated = sessionStorage.getItem(storageKey);
      if (!authenticated) {
        return new Promise((resolve, reject) => {
          createPasswordModal(resolve, () => {
            alert("Access denied.");
            window.location.href = "about:blank";
            reject();
          });
        });
      }
      return Promise.resolve();
    }

    window.addEventListener("DOMContentLoaded", async () => {
      await authenticate();
      // âœ… Reveal dashboard after successful authentication
      document.querySelectorAll(".screen").forEach(el => el.style.display = "block");
    });
  </script>
</head>

<body>

  <!-- Pharma dashboard -->
  <div class="screen active" id="pharmaScreen">
    <iframe id="pharmaFrame"></iframe>
  </div>

  <!-- Banner screen -->
  <div class="screen" id="bannerScreen">
    <iframe id="bannerFrame"></iframe>
    <header id="overlayTitle"></header>
  </div>

  <script>
    const pharmaScreen = document.getElementById("pharmaScreen");
    const bannerScreen = document.getElementById("bannerScreen");
    const overlayTitle = document.getElementById("overlayTitle");
    const pharmaFrame = document.getElementById("pharmaFrame");
    const bannerFrame = document.getElementById("bannerFrame");

    pharmaFrame.src = "Pharma_Telesales_Statistics.html?nocache=" + new Date().getTime();
    bannerFrame.src = "Banner.html?nocache=" + new Date().getTime();

    function updateHeader() {
      const now = new Date();
      const formattedDate = now.toLocaleString("en-GB", {
        day: "2-digit",
        month: "long",
        year: "numeric",
        hour: "2-digit",
        minute: "2-digit",
        second: "2-digit"
      }).replace(",", "");

      const formattedTime = formattedDate.replace(
        /\b([A-Za-z]+)\b/,
        (match) => match.toUpperCase()
      );

      overlayTitle.textContent = `PHARMA TELESALES PERFORMANCE AS AT ${formattedTime} | # OPERATION NIGHT HAMMER`;
    }

    setInterval(updateHeader, 1000);
    updateHeader();

    const pharmaDuration = 120000; // 2 minutes
    const bannerDuration = 10000;  // 10 seconds
    let showingBanner = false;

    function switchScreens() {
      if (showingBanner) {
        bannerScreen.classList.remove("active");
        pharmaScreen.classList.add("active");
        showingBanner = false;
        localStorage.setItem("lastFlip_pharma", Date.now());
        setTimeout(switchScreens, pharmaDuration);
      } else {
        pharmaScreen.classList.remove("active");
        bannerScreen.classList.add("active");
        showingBanner = true;
        localStorage.setItem("lastFlip_pharma", Date.now());
        setTimeout(switchScreens, bannerDuration);
      }
    }

    const lastFlip = localStorage.getItem("lastFlip_pharma");
    if (lastFlip) {
      const elapsed = Date.now() - lastFlip;
      const totalCycle = pharmaDuration + bannerDuration;
      const modTime = elapsed % totalCycle;

      if (modTime < pharmaDuration) {
        pharmaScreen.classList.add("active");
        bannerScreen.classList.remove("active");
        showingBanner = false;
        setTimeout(switchScreens, pharmaDuration - modTime);
      } else {
        pharmaScreen.classList.remove("active");
        bannerScreen.classList.add("active");
        showingBanner = true;
        setTimeout(switchScreens, totalCycle - modTime);
      }
    } else {
      pharmaScreen.classList.add("active");
      bannerScreen.classList.remove("active");
      showingBanner = false;
      localStorage.setItem("lastFlip_pharma", Date.now());
      setTimeout(switchScreens, pharmaDuration);
    }
  </script>

</body>
</html>
